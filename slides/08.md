---
presentation:
  margin: 0
  center: false
  transition: "convex"
  enableSpeakerNotes: true
  slideNumber: "c/t"
  navigationMode: "linear"
---

@import "../css/font-awesome-4.7.0/css/font-awesome.css"
@import "../css/theme/solarized.css"
@import "../css/logo.css"
@import "../css/font.css"
@import "../css/color.css"
@import "../css/margin.css"
@import "../css/table.css"
@import "../css/main.css"
@import "../plugin/zoom/zoom.js"
@import "../plugin/customcontrols/plugin.js"
@import "../plugin/customcontrols/style.css"
@import "../plugin/chalkboard/plugin.js"
@import "../plugin/chalkboard/style.css"
@import "../plugin/menu/menu.js"
@import "../js/anychart/anychart-core.min.js"
@import "../js/anychart/anychart-venn.min.js"
@import "../js/anychart/pastel.min.js"
@import "../js/anychart/venn-ml.js"

<!-- slide data-notes="" -->

<div class="bottom20"></div>

# 机器学习

<hr class="width50 center">

## 朴素贝叶斯

<div class="bottom8"></div>

### 计算机学院 &nbsp;&nbsp; 张腾

#### _tengzhang@hust.edu.cn_

<!-- slide vertical=true data-notes="" -->

##### 大纲

---

@import "../vega/outline.json" {as="vega" .top-2}

<!-- slide data-notes="" -->

##### 贝叶斯决策论

---

- 样本空间$\Xcal \subseteq \Fbb^d$，类别标记空间为$\Ycal$
- $\Dcal$是$\Xcal \times \Ycal$上的未知概率分布，概率密度函数为$\Pbb(\xv, y)$
- 损失函数$\ell: \Ycal \times \Ycal \mapsto \Rbb$

学习器$h: \Xcal \mapsto \Ycal$的泛化风险为

$$
\begin{align*}
    \qquad R_{\Dcal} (h) & = \Ebb_{(\xv,y) \sim \Dcal} [\ell(y, h(\xv))] = \iint \ell(y, h(\xv)) \Pbb(\xv, y) \diff \xv \diff y \\
    & = \int \left( \int \ell(y, h(\xv)) \Pbb(y|\xv) \diff y \right) \Pbb(\xv) \diff \xv \\
    & = \Ebb_{\xv} \left[ \int \ell(y, h(\xv)) \Pbb(y|\xv) \diff y \right] = \Ebb_{\xv} [ \Ebb_y [\ell(y, h(\xv)) | \xv]]
\end{align*}
$$

<div class="top-4"></div>

最小泛化风险称为{==贝叶斯风险==}，对应的$h^\star$即{==贝叶斯最优学习器==}

$$
\begin{align*}
    \qquad h^\star(\xv) = \mathop{\arg\min}_{h(\xv)} \int \ell(y, h(\xv)) \Pbb(y|\xv) \diff y
\end{align*}
$$

<!-- slide vertical=true data-notes="" -->

##### 贝叶斯最优学习器

---

<div class="top2"></div>

$$
\begin{align*}
    \qquad h^\star(\xv) = \mathop{\arg\min}_{h(\xv)} \int \ell(y, h(\xv)) \Pbb(y|\xv) \diff y
\end{align*}
$$

<div class="top-4"></div>

回归问题通常采用平方损失$\ell(y, h(\xv)) = (y - h(\xv))^2$

$$
\begin{align*}
    \qquad \nabla_{h(\xv)} \left( \int (y - h(\xv))^2 \Pbb(y|\xv) \diff y \right) & = 2 \int (h(\xv) - y) \Pbb(y|\xv) \diff y \\
    & = 2 h(\xv) - 2 \int y \Pbb(y|\xv) \diff y \\
    & = 2 h(\xv) - 2 \Ebb[y|\xv]
\end{align*}
$$

<div class="top-4"></div>

即回归问题的贝叶斯最优模型$h^\star(\xv) = \Ebb[y|\xv]$

我的批注 在偏差方差分解中我们曾得到相同的结论

$$
\begin{align*}
    \qquad \Ebb_{(\xv,y) \sim \Dcal} [(y - h(\xv))^2] = \Ebb_{\xv} [(h(\xv) - \Ebb [y|\xv])^2] + \noise
\end{align*}
$$

<!-- slide vertical=true data-notes="" -->

##### 贝叶斯最优学习器

---

<div class="top2"></div>

$$
\begin{align*}
    \qquad h^\star(\xv) = \mathop{\arg\min}_{h(\xv)} \int \ell(y, h(\xv)) \Pbb(y|\xv) \diff y
\end{align*}
$$

<div class="top-4"></div>

对分类问题，设$\Ycal = [c]$，$\ell(y, h(\xv)) = \Ibb(y \ne h(\xv))$，则

<div class="top1"></div>

$$
\begin{align*}
    \qquad h^\star(\xv) & = \mathop{\arg\min}_{\yhat \in [c]} \sum_{y \in [c]} \Ibb(y \ne \yhat) \Pbb(y|\xv) \\[4pt]
    & = \mathop{\arg\min}_{\yhat \in [c]} ~ (1 - \Pbb(\yhat|\xv)) \\[4pt]
    & = \mathop{\arg\max}_{\yhat \in [c]} ~ \Pbb(\yhat|\xv)
\end{align*}
$$

<div class="top-4"></div>

即分类问题的贝叶斯最优模型$h^\star(\xv) = \mathop{\arg\max}_{\yhat \in [c]} \Pbb(\yhat|\xv)$

我的批注 对于分类问题，{==泛化风险最小化==}等价于{==后验概率最大化==}

<!-- slide data-notes="" -->

##### 判别式 _vs._ 生成式

---

后验概率最大化的两种实现方式：判别式方法、生成式方法

判别式方法：直接用线性判别式拟合后验概率，如对率回归

$$
\begin{align*}
    \quad [\Pbb(y=1|\xv), \ldots, \Pbb(y=c|\xv)] = \softmax (\wv_1^\top \xv, \ldots, \wv_c^\top \xv)
\end{align*}
$$

生成式方法：曲线迂回，从数据的生成机制入手

$$
\begin{align*}
    \quad \overbrace{\Pbb(y|\xv)}^{\text{后验}} & = \frac{\overbrace{\class{yellow}{\Pbb(y)}}^{\text{先验}} \times \overbrace{\class{blue}{\Pbb(\xv|y)}}^{\text{似然}}}{\Pbb(\xv)}
    \Longrightarrow \begin{cases} \Pbb(y = 1 | \xv) \propto \class{yellow}{\Pbb(y=1)} \class{blue}{\Pbb(\xv|y=1)} \\
    \qquad \vdots \\
    \Pbb(y = c | \xv) \propto \class{yellow}{\Pbb(y=c)} \class{blue}{\Pbb(\xv|y=c)} \end{cases} \\[10pt]
    & \Longrightarrow \mathop{\arg \max}_{y \in [c]} \Pbb(y|\xv) = \mathop{\arg \max}_{y \in [c]} \Pbb(y) \Pbb(\xv | y)
\end{align*}
$$

<!-- slide vertical=true data-notes="" -->

##### 朴素贝叶斯

---

<div class="top2"></div>

$$
\begin{align*}
    \qquad \mathop{\arg \max}_{y \in [c]} \Pbb(y|\xv) = \mathop{\arg \max}_{y \in [c]} \Pbb(y) \Pbb(\xv | y)
\end{align*}
$$

<div class="top-4"></div>

注意$\xv = [x_1; x_2; \ldots; x_d]$，于是似然

$$
\begin{align*}
    \qquad \Pbb(\xv | y) = \Pbb(x_1 | y) \cdot \Pbb(x_2 | x_1, y) \cdots \Pbb(x_d | x_{d-1}, \ldots, x_2, x_1, y)
\end{align*}
$$

<div class="top-3"></div>

当特征数$d$很大时似然会很难计算 (要考虑所有特征的所有取值)

<div class="top4"></div>

朴素贝叶斯 (<u>n</u>aïve <u>B</u>ayes, NB) 引入{==条件独立性假设==}：

$$
\begin{align*}
    \qquad \Pbb(\xv | y) = \Pbb(x_1 | y) \cdot \Pbb(x_2 | y) \cdots \Pbb(x_d | y) = \prod_{j \in [d]} \Pbb(x_j | y)
\end{align*}
$$

<div class="top-2"></div>

问题：如何用数据集估计$\Pbb(y), ~ \Pbb(x_1 | y), ~ \Pbb(x_2 | y), ~ \ldots, ~ \Pbb(x_d | y)$

<!-- slide data-notes="" -->

##### 从数据中估计参数

---

<div class="top2"></div>

$$
\begin{align*}
    \qquad \Pbb(y | \xv) = \Pbb(y) \cdot \Pbb(x_1 | y) \cdot \Pbb(x_2 | y) \cdots \Pbb(x_d | y)
\end{align*}
$$

对于先验，记参数$\alpha_k = \Pbb(y = k)$，于是

$$
\begin{align*}
    \qquad \Pbb(y | \alpha_k) = \prod_{k \in [c]} \Pbb(y = k)^{\Ibb(y=k)} = \prod_{k \in [c]} \alpha_k^{\Ibb(y=k)}
\end{align*}
$$

对于似然，设第$j$个特征共有$n_j$种不同取值$v_1^{(j)}, \ldots, v_{n_j}^{(j)}$

<div class="top-2"></div>

记参数$\theta_{jlk} = \Pbb( x_j = v_l^{(j)} | y=k)$，于是对$\forall j \in [d]$和$\forall k \in [c]$有

$$
\begin{align*}
    \qquad \Pbb(x_j | y = k, \theta_{jlk}) & = \prod_{l \in [n_j]} \Pbb( x_j = v_l^{(j)} | y=k)^{\Ibb(x_j = v_l^{(j)})} = \prod_{l \in [n_j]} \theta_{jlk}^{\Ibb(x_j = v_l^{(j)})} \\
    \sum_{l \in [n_j]} \theta_{jlk} & = 1
\end{align*}
$$

<!-- slide vertical=true data-notes="" -->

##### 从数据中估计参数

---

设数据集$D = \{ (\xv^{(i)}, y^{(i)}) \}_{i \in [m]}$，对数似然函数：

$$
\begin{align*}
    \quad & \log \Pbb(D | \alphav, \thetav) = \sum_{i \in [m]} \log \Pbb(\xv^{(i)}, y^{(i)} | \alphav, \thetav) \\
    & = \sum_{i \in [m]} \log \prod_{k \in [c]} \Pbb(\xv^{(i)}, y^{(i)} = k | \alphav, \thetav)^{\Ibb(y^{(i)}=k)} \\
    & = \sum_{i \in [m]} \sum_{k \in [c]} \Ibb(y^{(i)}=k) \log \Pbb(\xv^{(i)}, y^{(i)} = k | \alphav, \thetav) \\
    & = \sum_{i \in [m]} \sum_{k \in [c]} \Ibb(y^{(i)}=k) \log \Pbb(y^{(i)} = k | \alphav) \\ & \qquad \qquad + \sum_{i \in [m]} \sum_{k \in [c]} \Ibb(y^{(i)}=k) \log \Pbb(\xv^{(i)} | y^{(i)} = k, \thetav) \\[4pt]
    & = \sum_{k \in [c]} \sum_{i \in [m]} \underbrace{\Ibb(y^{(i)}=k) \log \alpha_k}_{\alphav~\text{相关的项}\qquad} + \sum_{k \in [c]} \sum_{i \in [m]} \underbrace{\Ibb(y^{(i)}=k) \log \Pbb(\xv^{(i)} | y^{(i)} = k, \thetav)}_{\thetav~\text{相关的项}\qquad}
\end{align*}
$$

<!-- slide data-notes="" -->

##### 极大似然估计

---

记$A_k = \sum_{i \in [M]} \Ibb(y^{(i)} = k)$为第$k$类样本数

$\alphav$相关的项

$$
\begin{align*}
    \qquad \max_{\alpha_k} \sum_{k \in [c]} \sum_{i \in [m]} \Ibb(y^{(i)}=k) \log \alpha_k = \sum_{k \in [c]} A_k \log \alpha_k, \quad \st \sum_{k \in [c]} \alpha_k = 1
\end{align*}
