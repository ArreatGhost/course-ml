---
presentation:
  margin: 0
  center: false
  transition: "convex"
  enableSpeakerNotes: true
  slideNumber: "c/t"
  navigationMode: "linear"
---

@import "../css/font-awesome-4.7.0/css/font-awesome.css"
@import "../css/theme/solarized.css"
@import "../css/logo.css"
@import "../css/font.css"
@import "../css/color.css"
@import "../css/margin.css"
@import "../css/table.css"
@import "../css/main.css"
@import "../plugin/zoom/zoom.js"
@import "../plugin/customcontrols/plugin.js"
@import "../plugin/customcontrols/style.css"
@import "../plugin/chalkboard/plugin.js"
@import "../plugin/chalkboard/style.css"
@import "../plugin/menu/menu.js"
@import "../js/anychart/anychart-core.min.js"
@import "../js/anychart/anychart-venn.min.js"
@import "../js/anychart/pastel.min.js"
@import "../js/anychart/venn-ml.js"
@import "https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.js"

<!-- slide data-notes="" -->

<div class="bottom20"></div>

# 机器学习

<hr class="width50 center">

## k-近邻法

<div class="bottom8"></div>

### 计算机学院 &nbsp;&nbsp; 张腾

#### _tengzhang@hust.edu.cn_

<!-- slide vertical=true data-notes="" -->

##### 大纲

---

@import "../vega/outline.json" {as="vega" .top-2}

<!-- slide data-notes="" -->

##### <span style="font-weight:900">k-</span>近邻法

---

基本假设：{==相似的样本属于相同的类别==}

<div class="top-2"></div>

如何刻画相似？距离函数：$\dist(\cdot, \cdot): \Xcal \times \Xcal \mapsto \Rbb^+$

<div class="top-2"></div>

集合、距离函数对$(\Xcal, \dist(\cdot, \cdot))$构成{==度量空间==} (metric space)

<div class="top2"></div>

输入：$D = \{ (\xv_i, y_i) \}_{i \in [m]} \in (\Xcal \times \Ycal)^m$，近邻数$k$，待预测样本$\xv$

<div class="top-3"></div>

输出：$\xv$的类别$y$

1. 求解$N_k(\xv) \subseteq D$使得$|N_k(\xv)| = k$且对$\forall (\xv', y') \in D \setminus N_k(\xv)$有$\dist(\xv, \xv') \geq \max_{\zv \in N_k(\xv)} \dist (\xv, \zv)$
2. 输出$\mode(\{ y'': (\xv'', y'') \in N_k(\xv) \})$，其中$\mode(\cdot)$表示众数

<div class="top4"></div>

我的批注 近邻法没有{==显式==}的学习过程

<!-- slide vertical=true data-notes="" -->

##### 空间划分 <span style="font-weight:900">1-</span>近邻

---

@import "../tikz/knn.svg" {.center .width50 .top5}

<!-- slide vertical data-notes="" -->

##### 超参设置

---

近邻数$k$：取值范围$[m] \wedge \{2 \Zbb + 1\}$

- 奇数可保证取众数时不会出现打平的情况，zyzzj 常委都是奇数位
- 越小越容易过拟合，越大越容易欠拟合，实操时可通过交叉验证选取

<div class="top2"></div>

距离函数：

- 闵可夫斯基距离：$\dist(\xv, \zv) = \| \xv - \zv \|_p$
- 马氏距离：$\dist_\Mv (\xv, \zv) \triangleq \sqrt{(\xv - \zv)^\top \Mv (\xv - \zv)}$，比如$\Mv$为对角阵$\diag\{w_1, \ldots, w_d\}$时，马氏距离就是加权平方距离$\sqrt{\sum_{j \in [d]} w_j (x_j - z_j)^2}$

<div class="top2"></div>

度量学习 (metric learning)：找一个更好的特征空间，记$\Mcal$为同类样本对集合，$\Ccal$为异类样本对集合

$$
\begin{align*}
    \quad \min_\Mv & \sum_{(\xv_i, \xv_j) \in \Mcal} \dist(\xv_i, \xv_j), \quad \st \sum_{(\xv_i, \xv_j) \in \Ccal} \dist(\xv_i, \xv_j) \ge 1, ~ \Mv \succeq \zerov
\end{align*}
$$

<!-- slide vertical data-notes="" -->

##### 优劣

---

优点

- 简单 (概念上、实现上)
- 无训练过程，只需存下数据，惰性学习 (lazy learning)
- 样本极少时也能用
- $\Xcal$维度不高时效果很好
- {==一致性==}：若贝叶斯最优分类器的错误率$R^\star = 0$，k-近邻也能渐进达到

<div class="top4"></div>

缺点

- 预测很慢，要计算待预测样本与训练集中所有样本的距离
- {==维度灾难==}：高维空间中的距离会失效，k-近邻效果很差

<!-- slide data-notes="" -->

##### 理论分析 <span style="font-weight:900">1-</span>近邻法

---

定理：设$(\Xcal, \dist(\cdot, \cdot))$是{==可分==}度量空间，标记集合$\Ycal = \{ 1, -1 \}$，贝叶斯最优分类器$h^\star(\xv) = \mathop{\arg\max}_{y \in \Ycal} \Pbb(y|\xv)$的错误率为$R^\star$，训练集$D = \{ (\xv_i, y_i) \}_{i \in [m]} \in (\Xcal \times \Ycal)^m$，1-近邻法的错误率为$R_m$，记$R = \lim_{m \rightarrow \infty} R_m$，则$R^\star \le R \le 2 R^\star (1 - R^\star)${==以概率 1 成立==}

一些说明：

- 下界是显然的，不可能比贝叶斯最优分类器更好
- 1-近邻法最坏情况下错误率不超过贝叶斯最优分类器的 2 倍
- 当$R^\star = 0$ (两类完全分开) 或$R^\star = 1/2$ (两类完全重叠) 时，界是紧的
- 以概率 1 成立又称{==几乎必然==} (almost surely, a.s.) 成立

<!-- slide data-notes="" -->

##### 概念解释 空间

---

空间 = 集合 + 结构

- 集合：把需要研究元素放到一起
- 结构：描述元素必须遵循的规则

<div class="top2"></div>

代数结构：加法和数乘的 8 条公理，线性空间，也叫向量空间

<div class="top-2"></div>

线性空间无法计算两个元素的距离，从而无法谈序列的收敛性

引入几何结构刻画元素间的亲疏远近，由弱到强依次有

- 邻域 (开集族)：拓扑空间
- 距离$\dist(\cdot, \cdot): \Xcal \times \Xcal \mapsto \Rbb^+$：度量空间
- 代数结构 + $\|\cdot\|$：赋范空间，$\dist(\xv, \zv) = \| \xv - \zv \|$
- 代数结构 + $\langle \cdot, \cdot \rangle$：内积空间，$\| \xv - \zv \|_2^2 = \langle \xv, \xv \rangle - 2 \langle \xv, \zv \rangle + \langle \zv, \zv \rangle$

<!-- slide vertical=true data-notes="" -->

##### 概念解释 空间

---

完备性：对极限运算封闭，空间内的柯西序列能收敛

- $\Qbb$不完备，$\lim_{n \rightarrow \infty} (1 + 1 / n)^n = e$，$\Qbb$的完备化是$\Rbb$

<div class="top2"></div>

@import "../dot/space.dot" {.center}

<div class="top-3"></div>

可分性：具有可数稠密子集

- 若度量空间$\Xcal$的子集$\Mcal$满足对$\forall x \in \Xcal$，$x$的任意邻域与$\Mcal$交集非空，则称$\Mcal$在$\Xcal$中稠密
- $\Qbb$在$\Rbb$中稠密，$\Qbb$可数，因此$\Rbb$可分

<!-- slide data-notes="" -->

##### 概念解释 几乎必然

---

引理：若$(\Xcal, \dist(\cdot, \cdot))$是{==可分==}度量空间，设

$$
\begin{align*}
    \quad D_1 = \{ \xv_1 \}, ~ D_2 = \{ \xv_1, \xv_2 \}, ~ \ldots, D_n = \{ \xv_1, \xv_2, \ldots, \xv_n \}, ~ \ldots, ~ \xv_i \overset{\text{iid}}{\sim} \Dcal
\end{align*}
$$

<div class="top-3"></div>

对任意$\xv$，记$\xvhat_n = \mathop{\arg \min}_{\zv \in D_n} \dist (\xv, \zv)$，则序列$\xvhat_n \overset{\text{a.s.}}{\rightarrow} \xv$

证明：记以$\xv$为球心、$r$为半径的球为$B_\xv(r)$

若对$\forall r > 0$有$\Pbb(B_\xv(r)) > 0$，则

$$
\begin{align*}
    \quad \Pbb(\dist(\xvhat_n, \xv) > r) = (1 - \Pbb(B_\xv(r)))^n \rightarrow 0
\end{align*}
$$

<div class="top-4"></div>

由$r$的任意性知$\Pbb(\dist(\xvhat_n, \xv) = 0) \rightarrow 1$，从而$\xvhat_n \overset{\text{a.s.}}{\rightarrow} \xv$

最后还需说明“对$\forall r > 0$有$\Pbb(B_\xv(r)) > 0$”以概率 1 成立

<!-- slide vertical=true data-notes="" -->

##### 概念解释 几乎必然

---

引理：若$(\Xcal, \dist(\cdot, \cdot))$是{==可分==}度量空间，设

$$
\begin{align*}
    \quad D_1 = \{ \xv_1 \}, ~ D_2 = \{ \xv_1, \xv_2 \}, ~ \ldots, D_n = \{ \xv_1, \xv_2, \ldots, \xv_n \}, ~ \ldots, ~ \xv_i \overset{\text{iid}}{\sim} \Dcal
\end{align*}
$$

<div class="top-3"></div>

对任意$\xv$，记$\xvhat_n = \mathop{\arg \min}_{\zv \in D_n} \dist (\xv, \zv)$，则序列$\xvhat_n \overset{\text{a.s.}}{\rightarrow} \xv$

证明：易知“对$\forall r > 0$有$\Pbb(B_\xv(r)) > 0$”的否命题为“存在$r > 0$使得$\Pbb(B_\xv(r)) = 0$”，设这样的$\xv$构成集合$N$，只需证$\Pbb(N) = 0$

设$\Xcal$的可数稠密子集为$\Acal$，由可分性，存在$\av \in B_\xv(r/3) \wedge \Acal$，于是$\xv \in B_\av (r/2) \subseteq B_\xv(r)$，从而$\Pbb(B_\av (r/2)) = 0$

若上述过程产生多个以$\av$为球心的球，取并集 (最大半径球)，注意$\Acal$可数，即可数个概率为零的球可覆盖全部$\xv$，$\Pbb(N) = 0$
